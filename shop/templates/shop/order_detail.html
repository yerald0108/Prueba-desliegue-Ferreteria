{% extends 'shop/base.html' %}

{% block title %}Orden {{ order.order_number }} - Ferretería{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- Header de confirmación -->
            <div class="text-center mb-5">
                <i class="bi bi-check-circle-fill text-success" style="font-size: 5rem;"></i>
                <h2 class="mt-3">¡Pedido Realizado Exitosamente!</h2>
                <p class="text-muted">Tu orden ha sido recibida y está siendo procesada</p>
            </div>
            
            <div class="card shadow-sm mb-4">
                <div class="card-body p-4">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5><i class="bi bi-receipt"></i> Detalles de la Orden</h5>
                            <p class="mb-1"><strong>Número de Orden:</strong> {{ order.order_number }}</p>
                            <p class="mb-1"><strong>Fecha:</strong> {{ order.created_at|date:"d/m/Y H:i" }}</p>
                            <p class="mb-1">
                                <strong>Estado:</strong> 
                                <span class="badge bg-{% if order.status == 'pending' %}warning{% elif order.status == 'confirmed' %}info{% elif order.status == 'delivered' %}success{% else %}secondary{% endif %}">
                                    {{ order.get_status_display }}
                                </span>
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h5><i class="bi bi-truck"></i> Información de Entrega</h5>
                            <p class="mb-1"><strong>Fecha de entrega:</strong> {{ order.delivery_date|date:"d/m/Y" }}</p>
                            <p class="mb-1"><strong>Horario:</strong> {{ order.get_delivery_time_display }}</p>
                            <p class="mb-1"><strong>Método de pago:</strong> {{ order.get_payment_method_display }}</p>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h6><i class="bi bi-geo-alt"></i> Dirección de Entrega</h6>
                            <p class="mb-0">{{ order.delivery_address }}</p>
                            <p class="mb-0">{{ order.delivery_city }}, {{ order.delivery_province }}</p>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="bi bi-telephone"></i> Contacto</h6>
                            <p class="mb-0">{{ order.contact_phone }}</p>
                            <p class="mb-0 text-muted">{{ order.user.email }}</p>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <h5 class="mb-3"><i class="bi bi-box-seam"></i> Productos</h5>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th class="text-center">Cantidad</th>
                                    <th class="text-end">Precio Unit.</th>
                                    <th class="text-end">Subtotal</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in order.items.all %}
                                    <tr>
                                        <td>
                                            <strong>{{ item.product.name }}</strong><br>
                                            <small class="text-muted">SKU: {{ item.product.sku }}</small>
                                        </td>
                                        <td class="text-center">{{ item.quantity }}</td>
                                        <td class="text-end">${{ item.price }}</td>
                                        <td class="text-end"><strong>${{ item.subtotal }}</strong></td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="3" class="text-end"><strong>Subtotal:</strong></td>
                                    <td class="text-end">${{ order.subtotal }}</td>
                                </tr>
                                <tr>
                                    <td colspan="3" class="text-end"><strong>Envío:</strong></td>
                                    <td class="text-end">${{ order.delivery_fee }}</td>
                                </tr>
                                <tr class="table-primary">
                                    <td colspan="3" class="text-end"><h5 class="mb-0">Total:</h5></td>
                                    <td class="text-end"><h5 class="mb-0 text-primary">${{ order.total }}</h5></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    
                    {% if order.notes %}
                        <hr>
                        <h6><i class="bi bi-chat-left-text"></i> Notas del Pedido</h6>
                        <p class="text-muted">{{ order.notes }}</p>
                    {% endif %}
                </div>
            </div>
            
            <div class="alert alert-info">
                <i class="bi bi-info-circle"></i>
                <strong>¿Qué sigue?</strong><br>
                Te contactaremos al número {{ order.contact_phone }} para confirmar tu pedido y coordinar la entrega.
                También recibirás actualizaciones por email.
            </div>
            
            <div class="text-center">
                <a href="{% url 'shop:order_history' %}" class="btn btn-outline-primary me-2">
                    <i class="bi bi-clock-history"></i> Ver Mis Órdenes
                </a>
                <a href="{% url 'shop:home' %}" class="btn btn-primary">
                    <i class="bi bi-house"></i> Volver al Inicio
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}